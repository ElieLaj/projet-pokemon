<div class="battle">
    <div class="battle-screen">
        <div class="battle-screen__header">
            <h1>Battle</h1>
            <h2>
                <span class="player">{{ game.playerMonster.name }}</span>
                VS
                <span class="enemy">{{ game.enemyMonster.name }}</span>
            </h2>
            <h2>Turn: {{ game.currentTurn }}</h2>
            <h2>Score: {{ game.playerScore }}</h2>
            <h2>Current turn: {{ game.turn }}</h2>
            <h2>Enemy turn: {{ game.enemyAction }}</h2>
            <h2>Last turn: {{ game.lastTurn }}</h2>
        </div>
        <div class="battle-screen__monsters">
            <div class="battle-screen__player">
                <app-monster
                    [monster]="game.playerMonster"
                    [active]="true">
                </app-monster>
            </div>
            <div class="battle-screen__enemy">
                <app-monster
                    [monster]="game.enemyMonster"
                    [active]="true"
                    [isPlayer]="false">
                </app-monster>
            </div>
        </div>
        <div class="battle-screen__inputs">
            <div class="battle-screen__actions">
                @if (!game.playerAction && game.dialogues.length === 0) {
                    <button class="battle-screen__actions-attack" (click)="game.setAction(game.ActionType.SelectAttack)">Attack</button>
                    <button class="battle-screen__actions-item" (click)="game.setAction(game.ActionType.SelectItemType)">Item</button>
                    <button class="battle-screen__actions-swap" (click)="game.setAction(game.ActionType.Swap)">Swap</button>
                    <button class="battle-screen__actions-run" (click)="game.setAction(game.ActionType.Run)">Run</button>
                }
                
                @if (game.playerAction === game.ActionType.SelectAttack) {
                    <div class="battle-screen__attack-options">
                        @for (pokemonMove of game.playerMonster.pokemonMoves; track pokemonMove.id) {
                            <button
                                (click)="game.playerSelectedAttack = pokemonMove.move; game.setAction(game.ActionType.Attack)"
                                [style.background]="calculateBg(pokemonMove.move.type.name)">
                                {{ pokemonMove.move.name }}
                            </button>
                        }
                    </div>
                }
                @else if (game.playerAction === game.ActionType.SelectItemType) {
                    <div class="battle-screen__item-options">
                        <button (click)="game.chooseItemType('pokeball')">Pokeballs</button>
                        <button (click)="game.chooseItemType('heal')">Healing Items</button>
                    </div>
                }
                @else if (game.playerAction === game.ActionType.SelectItem) {
                    <div class="battle-screen__item-options">
                        @for (item of game.playerSelectedBag; track item.id) {
                            <button
                                (click)="game.playerSelectItem(item)"
                                [style.background]="calculateBg('normal')">
                                {{ item.name }}
                            </button>
                        }
                    </div>
                }
            </div>
            
            @if (game.playerAction) {
                <button class="battle-screen__cancel" (click)="game.playerAction = null">Cancel</button>
            }
            
            <div class="battle-screen__log">
                <app-dialogue
                    [dialogues]="game.dialogues"
                    (next)="game.dialogues = $event">
                </app-dialogue>
            </div>
        </div>
        
        <div class="battle-screen__status">
            @if (game.playerMonster.hp <= 0) {
                <h2>Game Over</h2>
            } @else if (game.enemyMonster.hp <= 0) {
                <h2>Victory</h2>
            }
        </div>
    </div>
</div>
